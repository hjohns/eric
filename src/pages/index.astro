---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getEntry } from 'astro:content';

const navItems = [
  { slug: 'home', label: 'Home' },
  { slug: 'the-book', label: 'The Book' },
  { slug: 'support', label: 'Support' },
  { slug: 'about', label: 'About' },
  { slug: 'videos', label: 'Videos' },
] as const;

const sections = await Promise.all(
  navItems.map(async ({ slug, label }) => {
    const entry = await getEntry('sections', slug);
    const { Content } = await entry.render();

    return {
      slug,
      label,
      title: entry.data.title,
      intro: entry.data.intro,
      Content,
    };
  })
);
---

<BaseLayout title="A History of Papua New Guinea" description="Learn about Eric Johns' comprehensive history of Papua New Guinea and the team working to place it in classrooms.">
  <header class="sticky top-0 z-50 border-b border-slate-200 bg-white/80 backdrop-blur">
    <div class="container-layout flex flex-wrap items-center justify-between gap-4 py-4">
      <a href="#top" class="text-lg font-semibold tracking-tight text-brand hover:text-brand-dark">PNG History Project</a>
      <nav>
        <ul class="section-nav flex flex-wrap items-center gap-4 text-sm font-medium text-slate-700">
          {navItems.map((item) => (
            <li><a class="nav-link rounded-md px-3 py-2 transition hover:bg-brand/10 hover:text-brand-dark" href={item.slug === 'home' ? '#top' : `#${item.slug}`}>{item.label}</a></li>
          ))}
        </ul>
      </nav>
    </div>
  </header>

  <section id="top" class="relative isolate overflow-hidden bg-slate-900 text-white">
    <div class="absolute inset-0">
      <img src="/images/banner.jpg" alt="Supporters waving Papua New Guinea flags" class="h-full w-full object-cover" loading="lazy" />
      <div class="absolute inset-0 bg-slate-900/70" />
    </div>
    <div class="container-layout relative flex min-h-[22rem] flex-col justify-center gap-6 py-16 sm:py-24">
      <div class="max-w-3xl border-l-4 border-brand pl-4">
        <p class="text-sm font-semibold uppercase tracking-[0.3em] text-brand-light">Eric Johns</p>
        <h1 class="text-4xl font-extrabold leading-tight sm:text-5xl md:text-6xl">Bringing Papua New Guinea's story to every classroom</h1>
        <p class="mt-3 max-w-2xl text-base text-slate-100 sm:text-lg">
          Discover the journey behind <em>A History of Papua New Guinea from Prehistory to Independence</em>, a 635-page volume researched over nearly two decades and published with the support of long-time collaborator Chris Roering.
        </p>
      </div>
      <div class="flex flex-wrap gap-3 text-sm">
        <a href="#the-book" class="rounded-md bg-brand px-4 py-2 font-semibold text-white transition hover:bg-brand-dark">Explore the Book</a>
        <a href="#about" class="rounded-md border border-white/60 px-4 py-2 font-semibold text-white transition hover:bg-white hover:text-slate-900">Meet the People</a>
      </div>
    </div>
  </section>

  <main class="flex-1">
    {sections.map(({ slug, title, intro, Content }) => {
      const backgroundClass =
        slug === 'home' || slug === 'support' || slug === 'videos'
          ? 'bg-slate-100/70'
          : 'bg-white';

      return (
        <section id={slug} class={`border-b border-slate-200 ${backgroundClass}`}>
          <div class="container-layout py-16 sm:py-20">
            {slug !== 'home' && (
              <div class="mx-auto max-w-3xl text-center">
                <p class="text-sm font-semibold uppercase tracking-[0.3em] text-brand">{title}</p>
                {intro && <p class="mt-3 text-lg text-slate-600">{intro}</p>}
              </div>
            )}
            <div class="section-content mx-auto mt-8 max-w-3xl text-left">
              <Content />
            </div>
          </div>
        </section>
      );
    })}
  </main>

  <footer class="bg-slate-900 py-8 text-slate-200">
    <div class="container-layout text-center text-sm">
      <p>&copy; {new Date().getFullYear()} PNG History Project</p>
    </div>
  </footer>
</BaseLayout>
